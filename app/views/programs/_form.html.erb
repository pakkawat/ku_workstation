<div class="row">
  <div class="col-sm-10">
    <span class="pull-left">
        <h1>
            <% if @program.persisted? %>
                Update program information
            <% else %>
                Add new program
            <% end %>
        </h1>
    </span>
  </div>
</div>

<%= form_for @program do |f| %>
<%= render 'shared/error_messages', object: f.object %>

<div class="row">
  <div class="col-sm-4"><!--left col-->
    <ul class="list-group">

      <li class="list-group-item text-muted">Information</li>
      <li class="list-group-item text-right">
        <span class="pull-left">
            <strong>
                <%= f.label :program_name,'Program Name', class: "control-label" %>
            </strong>
        </span>
        <%= f.text_field :program_name, class: "form-control" %>
      </li>

      <li class="list-group-item text-right">
        <span class="pull-left">
            <strong>
                <%= f.label :note,'Program note', class: "control-label" %>
            </strong>
        </span>
        <%= f.text_area(:note, rows: 10, class: 'form-control') %>
      </li>

      <li class="list-group-item text-center">
        <% if @program.persisted? %>
            <%= f.submit "Update program", class: "btn btn-primary" %>
        <% else %>
            <%= f.submit "Add program", class: "btn btn-success" %>
        <% end %>
      </li>
    
    </ul>
  </div><!--/col-4-->


  <div class="col-sm-6">
    <%= link_to_add_association "Add Action", f, :chef_resources, class: "btn btn-primary", partial: 'chef_main_resource_fields', :data => {"association-insertion-method" => "append","data-association-insertion-traversal" => "closest" } %>
    <div style="margin-top: 10px">
    </div>
    <div class="sortable">
        <%= f.fields_for :chef_resources, f.object.chef_resources do |builder| %>
                <%= render 'chef_main_resource_fields', f: builder %>
        <% end %>
    </div>
  </div><!--/col-9-->
</div>

<script type='text/javascript'>
  $(function (){
     $(document).on("change",".form-control", function (){
        var selectValue = $(this).val();
        var numberPattern = /\d+/g;
        var form_id = this.id.match( numberPattern );
        var form_type = $("input[type='hidden'][id$=_form_type]").val();
        //alert(form_type);
        temp_url = "/";
        if ( selectValue === "Repository") {
          $("[id$="+form_id+"_resource_name]").parent().show();
           temp_url += "install_repository_partial"
        }
        if ( selectValue === "Deb" ) {
          $("[id$="+form_id+"_resource_name]").parent().show();
           temp_url += "install_dep_partial"
        }
        if ( selectValue === "Source" ) {
          $("[id$="+form_id+"_resource_name]").parent().show();
           temp_url += "install_source_partial"
        }
        if ( selectValue === "Download" ) {
          $("[id$="+form_id+"_resource_name]").parent().hide();
           temp_url += "download_file_partial"
        }
        if ( selectValue === "Extract" ) {
          $("[id$="+form_id+"_resource_name]").parent().hide();
           temp_url += "extract_file_partial"
        }
        jQuery.ajax({
           url: temp_url,
           data: {'form_id' : form_id, 'form_type' : form_type},
           error: function(xhr, status, error){
              alert(xhr.responseText);
           }
     });
  });
});


</script>
<%= hidden_field_tag :program_id, @program.id %>
<%= javascript_include_tag "sortable/programs.js"%>


<% end %>
